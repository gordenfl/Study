# MongoDB basic knowledge

MongoDb is NoSQL database. It store all data as document format, all the format of document is BSON (like JSON)
It was developed by MongoDB Inc. fit for large scale storage and high performance and scalability.

## Core concept

1. Database: as other database system , it's a collection of data.
2. Collection: like "Table" in RDS. Document can store in this Collection. all the document don't need follow the fixed rule of Schema.
3. Document: like a row in RDS, using BSON(like json)
    BSON : is an binary object, and the Json is a string(text) object, that's the main different with each other.

```json
{
    "_id": ObjectId("32487052745824"), // auto generated by system
    "name": "Gordon",
    "age": 44,
    "email": "gordenfl@gmail.com"
}
```

## MongoDB Features

1. Aggregation all the document, and all the document can have different attributes and data type
2. High performance Read and Write, and it support Horizontal extend, fix for huge data storage
3. Sharding: Sharding automatically. distribute data to different node on the distribute database structure.
4. Replica Set, it can make multi replica provide service for applications
5. Search function : Complex search, Aggregation Pipeline, index etc.

## Common MongoDB Operation

1. Create Database and Collection

    ``` javascript
    use myDatabase // if mydatabase does not exist, MongoDB will create it
    db.createCollection("my_collection") // create a collection in myDatabase
    ```

2. Insert Document: documents can be different formant

    ```javascript
    db.my_collection.insertOne( {name:"Gordon", gender: "Male", age:44})
    db.my_collection.insertOne( {name:"Oneqiong", gender: "Female"})
    ```

3. Search Documents

    ```js
    db.my_collection.find({age:{$get:55}}) // get the age is greater or equal than 55
    ```

4. Update Documents

    ```js
    db.my_collection.updateOne(
        {name: "Gordon"},
        {$set: {age:45}},
    )
    ```

5. Delete Documents

    ```js
    db.my_collection.deleteOne({name:"Gordon"})
    ```

## All The Command List

1. Database

    | Option       | Command                  |
    | -------- | ------------------- |
    | Switch/Create db | `use dbName`        |
    | Show Current db  | `db`                |
    | Drop Current db  | `db.dropDatabase()` |
    | Show All db  | `show databases`    |

2. Collection

    | Option     | Command                                      |
    | ------ | --------------------------------------- |
    | Create Collection   | `db.createCollection("collectionName")` |
    | Show All Collections | `show collections`                      |
    | Delete Collection   | `db.collectionName.drop()`              |

3. Document

    | Option       | Command                                                                     |
    | -------- | ---------------------------------------------------------------------- |
    | Add Single Document   | `db.collectionName.insertOne({ field: value })`                        |
    | Add Multi Document   | `db.collectionName.insertMany([{...}, {...}])`                         |
    | Search All Document   | `db.collectionName.find()`                                             |
    | Query With Condition     | `db.collectionName.find({ field: value })`                             |
    | Query With Condition and Display with Format | `db.collectionName.find().pretty()`                                    |
    | Update Single Document   | `db.collectionName.updateOne({ filter }, { $set: { field: value } })`  |
    | Update Multi Document   | `db.collectionName.updateMany({ filter }, { $set: { field: value } })` |
    | Delete Single Document   | `db.collectionName.deleteOne({ filter })`                              |
    | Delete Multi Document   | `db.collectionName.deleteMany({ filter })`                             |

4. Index

    | Option   | Command                                            |
    | ---- | --------------------------------------------- |
    | Create Index | `db.collectionName.createIndex({ field: 1 })` |
    | List Index | `db.collectionName.getIndexes()`              |
    | Delete Index | `db.collectionName.dropIndex("indexName")`    |

5. Aggregation

    | Option     | Command                                                                                 |
    | ------ | ---------------------------------------------------------------------------------- |
    | 简单聚合管道 | `db.collectionName.aggregate([{ $group: { _id: "$field", total: { $sum: 1 } } }])` |
    | 复杂聚合   | `db.collectionName.aggregate([{ $match: { field: value } }, { $group: {...} }])`   |

6. Permission

    | Option   | Command                                                                                        |
    | ---- | ----------------------------------------------------------------------------------------- |
    | Create User | `db.createUser({ user: "username", pwd: "password", roles: [ "readWrite", "dbAdmin" ] })` |
    | Delete User | `db.dropUser("username")`                                                                 |
    | Get User | `db.getUsers()`                                                                           |

7. Other

    | Operate                   |     Command                            |
    | ---------------------------------- | ------------------------------------- |
    | Get current database statistic info | `db.stats()`                |
    | Get collection statistic info   | `db.collectionName.stats()` |
    | Get current connection status    | `db.serverStatus()`         |

8. Operation List

    | Symbol    | Means    |
    | ------ | ----- |
    | `$eq`  | equal    |
    | `$ne`  | not equal   |
    | `$gt`  | greater    |
    | `$gte` | greater or equal  |
    | `$lt`  | small    |
    | `$lte` | small or equal  |
    | `$in`  | in array  |
    | `$nin` | not in array |
    | `$and` | and     |
    | `$or`  | or     |

